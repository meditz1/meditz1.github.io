<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Skibidy Clicker</title>
    <style>
        #gameArea {
            position: relative;
            width: 100%;
            max-width: 1200px;
            height: 80vh;
            background-color: Black;
            margin: 0 auto;
            overflow: hidden;
            touch-action: none;
        }

        /* Add media query for mobile devices */
        @media (max-width: 768px) {
            #gameArea {
                height: 50vh; /* Shorter height on mobile */
            }
        }

        .image {
            position: absolute;
            width: 30px;
            height: 30px;
            cursor: pointer;
            transition: width 0.3s, height 0.3s;
            touch-action: none;
        }
        #money {
            position: relative;
            text-align: center;
            top: 0;
            left: 0;
            font-size: 2rem;
            font-weight: bold;
            margin: 10px 0;
        }
        #inventory {
            display: flex;
            flex-wrap: wrap;
            justify-content: center;
            gap: 10px;
            margin: 10px auto;
            max-width: 1200px;
            padding: 0 10px;
        }
        .inventory-item {
            flex: 0 0 auto;
        }
        .inventory-item img {
            width: 80px;
            height: 80px;
            display: block;
        }
        .sell-button {
            font-size: 12px;
            margin-top: 5px;
            cursor: pointer;
            background-color: #04d04f;
            color: white;
            border: none;
            border-radius: 3px;
            padding: 5px 10px;
            transition: background-color 0.3s ease;
        }
        .sell-button:hover {
            background-color: #cc2500;
        }
        #upgradeButtons {
            position: absolute;
            top: 750px;
            left: 50px;
        }
        .upgradeButton {
            font-size: 1rem;
            padding: 8px 12px;
            flex: 1 1 auto;
            min-width: 120px;
            max-width: 200px;
        }
        .upgradeButton:hover {
            background-color: #029516;
            transform: translateY(-2px);
            box-shadow: 0 4px 8px rgba(0,0,0,0.2);
        }
        .upgradeButton:active {
            transform: translateY(0);
            box-shadow: 0 2px 4px rgba(0,0,0,0.2);
        }
        .upgradeButton.unaffordable:hover {
            background-color: #cc0000;
            transform: translateY(-2px);
            box-shadow: 0 4px 8px rgba(0,0,0,0.2);
        }
        #raritiesChances {
            position: relative;
            top: auto;
            right: auto;
            margin: 10px auto;
            max-width: 1200px;
            width: 90%;
        }
        #raritiesList {
            list-style-type: none;
            padding: 0;
            margin: 0;
        }
        #muteButton {
            position: fixed;
            bottom: 10px;
            right: 10px;
            z-index: 1000;
        }
        #statsDisplay {
            position: relative;
            top: auto;
            right: auto;
            margin: 10px auto;
            max-width: 300px;
            width: 90%;
            background-color: rgb(0, 0, 0);
            padding: 15px;
            border-radius: 5px;
            color: rgb(250, 250, 250);
            font-size: 16px;
        }
        .stat-item {
            margin: 5px 0;
            display: flex;
            justify-content: space-between;
        }
        @keyframes moneyGain {
            0% { color: inherit; }
            50% { color: #00ff00; }
            100% { color: inherit; }
        }
        @keyframes moneyLoss {
            0% { color: inherit; }
            50% { color: #ff0000; }
            100% { color: inherit; }
        }
        .money-gain {
            animation: moneyGain .5s ease;
        }
        .money-loss {
            animation: moneyLoss .5s ease;
        }
        .controls-container {
            display: flex;
            flex-wrap: wrap;
            justify-content: center;
            gap: 10px;
            margin: 10px auto;
            max-width: 800px;
            padding: 0 10px;
        }
        /* Media queries for larger screens */
        @media (min-width: 768px) {
            .image {
                width: 15px;
                height: 15px;
            }
            #money {
                font-size: 2.5rem;
            }
            .upgradeButton {
                font-size: 1.2rem;
            }
        }
        /* Prevent text selection */
        * {
            user-select: none;
            -webkit-user-select: none;
            -moz-user-select: none;
            -ms-user-select: none;
        }
        #achievementsDisplay {
            position: relative;
            margin: 10px auto;
            max-width: 300px;
            width: 90%;
            background-color: #000;
            padding: 15px;
            border-radius: 5px;
            color: #fff;
        }

        .achievement {
            padding: 5px;
            margin: 5px 0;
            border-radius: 3px;
            background-color: #333;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .achievement.unlocked {
            background-color: #1a472a;
        }

        .achievement-bonus {
            font-size: 0.8em;
            color: #4CAF50;
        }

        /* Particle effect styles */
        .particle {
            position: absolute;
            pointer-events: none;
            animation: particle-animation 1s ease-out forwards;
        }

        @keyframes particle-animation {
            0% {
                transform: translate(0, 0) scale(1);
                opacity: 1;
            }
            100% {
                transform: translate(var(--tx), var(--ty)) scale(0);
                opacity: 0;
            }
        }

        /* Screen shake animation */
        @keyframes shake {
            0%, 100% { transform: translateX(0); }
            25% { transform: translateX(-5px); }
            75% { transform: translateX(5px); }
        }

        .shake {
            animation: shake 0.2s ease-in-out;
        }

        /* Pop effect for clicked images */
        @keyframes pop {
            0% { transform: scale(1); }
            50% { transform: scale(1.2); }
            100% { transform: scale(0); }
        }

        .pop {
            animation: pop 0.2s ease-out forwards;
        }

        /* Particle styles */
        .collect-particle {
            position: absolute;
            pointer-events: none;
            font-weight: bold;
            animation: float-up 0.5s ease-out forwards;
            z-index: 1000;
            color: #ffffff;
        }

        @keyframes float-up {
            0% {
                transform: translateY(0) scale(1);
                opacity: 1;
            }
            100% {
                transform: translateY(-50px) scale(1.2);
                opacity: 0;
            }
        }
    </style>
</head>
<body>

<!-- Audio element for background music -->
<audio id="backgroundMusic" loop>
    <source src="elevator-music-bossa-nova-background-music-version-60s-10900.mp3" type="audio/mpeg">
    Your browser does not support the audio element.
</audio>

<!-- Mute button -->
<button id="muteButton" style="position: fixed; bottom: 20px; right: 20px; padding: 10px 20px; font-size: 16px; cursor: pointer;">
    Mute
</button>
    
<div id="gameArea"></div>
<div id="money">$0</div>

<div class="controls-container">
    <button class="upgradeButton" id="buy1x">1x</button>
    <button class="upgradeButton" id="buy10x">10x</button>
    <button class="upgradeButton" id="buy100x">100x</button>
    <button class="upgradeButton" id="buyMax">Max</button>
</div>

<div class="controls-container">
    <button class="upgradeButton" id="upgradeImageSize">Image Size ($100)</button>
    <button class="upgradeButton" id="upgradeImageDuration">Image Duration ($200)</button>
    <button class="upgradeButton" id="upgradeInventorySpace">Inventory Space ($300)</button>
    <button class="upgradeButton" id="upgradeLuck">Luck ($500)</button>
    <button class="upgradeButton" id="sellAllButton">Sell All</button>
</div>

<div id="statsDisplay">
    <div class="stat-item">
        <span>Drop Size:</span>
        <span id="currentSize">15px</span>
    </div>
    <div class="stat-item">
        <span>Duration:</span>
        <span id="currentDuration">1.0s</span>
    </div>
    <div class="stat-item">
        <span>Inventory Space:</span>
        <span id="currentSpace">5</span>
    </div>
    <div class="stat-item">
        <span>Luck Level:</span>
        <span id="currentLuck">0</span>
    </div>
    <div class="stat-item">
        <span>Total Clicks:</span>
        <span id="totalClicks">0</span>
    </div>
    <div class="stat-item">
        <span>Items Found:</span>
        <span id="totalItems">0</span>
    </div>
</div>

<div id="raritiesChances">
    <ul id="raritiesList"></ul>
</div>
<div id="inventory"></div>

<!-- Modify achievements display to be collapsible -->
<div id="achievementsDisplay">
    <div id="achievementsHeader" style="cursor: pointer; display: flex; justify-content: space-between; align-items: center;">
        <h3>Achievements (Bonus: <span id="achievementBonus">0</span>%)</h3>
        <span id="toggleArrow">â–¼</span>
    </div>
    <div id="achievementsList" style="display: none; max-height: 300px; overflow-y: auto;"></div>
</div>

<script>

// Get references to the audio element and mute button
const backgroundMusic = document.getElementById('backgroundMusic');
const muteButton = document.getElementById('muteButton');

// Initialize music as paused
let isMuted = true;
muteButton.innerText = 'Unmute';

// Autoplay is not needed since we want to start paused
document.addEventListener('DOMContentLoaded', () => {
    // Don't autoplay - start paused
    backgroundMusic.pause();
});

// Mute button functionality
muteButton.addEventListener('click', () => {
    if (isMuted) {
        backgroundMusic.play();
        muteButton.innerText = 'Mute';
    } else {
        backgroundMusic.pause();
        muteButton.innerText = 'Unmute';
    }
    isMuted = !isMuted;
});

// Ensure the music loops infinitely
backgroundMusic.loop = true;
        const rarities = {
            common: 73.89,
            uncommon: 20,
            rare: 5,
            epic: 1,
            legendary: 0.1,
            mythical: 0.01,
        };

        const images = {
            common: [
                'https://github.com/user-attachments/assets/11dc033a-d7d7-48b5-a4bd-128bbc98465b',
                'https://github.com/user-attachments/assets/b6f1c7cb-d227-4b1d-94d9-f5cd5b24fa6f',
                'https://github.com/user-attachments/assets/c4167c26-b014-4e76-bc94-55f2631f246b',
                'https://github.com/user-attachments/assets/95672517-7aba-4c60-aa36-acab940b4208',
                'https://github.com/user-attachments/assets/bbe93a42-7673-48fb-866b-d22cc7066e96',
                'https://github.com/user-attachments/assets/fb97fed8-016b-4c9a-9371-539f10bdbb3c',
                'https://github.com/user-attachments/assets/eec643b9-a735-4d8d-9aab-808fd9194496',
                'https://github.com/user-attachments/assets/c7886242-55ee-45a6-83f5-28d9d029d7aa',
                'https://github.com/user-attachments/assets/4a1071c4-360f-44aa-ac85-d0a1fae6625e',
                'https://github.com/user-attachments/assets/fc6a33c9-4ec4-443a-8841-bac5cc9af1f0'
            ],
            uncommon: [
                'https://github.com/user-attachments/assets/9fbe770b-e6d6-49cc-beb4-2a6da602b152',
                'https://github.com/user-attachments/assets/788947e1-a656-4870-9f68-bcaa1aca5337',
                'https://github.com/user-attachments/assets/82c5b67a-6872-4ce8-b079-cd23e401f1b8',
                'https://github.com/user-attachments/assets/bac078b2-e64c-4019-aae3-aaa1cc494f74',
                'https://github.com/user-attachments/assets/4ebb2cc8-c4a6-4192-b3fb-6ce51f121d45',
                'https://github.com/user-attachments/assets/6d4e88e6-6008-4bf8-b21e-5eb8f252c041',
                'https://github.com/user-attachments/assets/50942121-55c3-4890-9a18-969bd7d1d7da',
                'https://github.com/user-attachments/assets/a879ebbc-1b86-45b6-aa23-cb4ea759f2f2',
                'https://github.com/user-attachments/assets/75675885-a9ea-4594-9d6e-4f5053d18c48',
                'https://github.com/user-attachments/assets/a97c9016-b808-4ba3-bdc1-25f95220e1fd'
            ],
            rare: [
                'https://github.com/user-attachments/assets/e432f392-3b84-4e69-ad69-e7cf9f6cc2e7',
                'https://github.com/user-attachments/assets/2758448d-dd43-4c33-acb5-4f6e7ab5f1d4',
                'https://github.com/user-attachments/assets/14529120-a4db-48aa-8210-821e8c295f8c',
                'https://github.com/user-attachments/assets/17ce7007-f9c0-4903-941d-3f85a4c24524',
                'https://github.com/user-attachments/assets/f0471a97-2f05-4641-9053-678432f0e48c',
                'https://github.com/user-attachments/assets/29691020-837c-4de3-ac4a-7ea118ceb7a5',
                'https://github.com/user-attachments/assets/9ee40a19-57b2-454d-8b52-99b28b232e91',
                'https://github.com/user-attachments/assets/810f99ae-e24c-4892-be53-141c699a6340',
                'https://github.com/user-attachments/assets/df56176a-d2e8-4eff-a016-db37c7528021',
                'https://github.com/user-attachments/assets/92807ca9-c45f-4075-af22-739143359748'
            ],
            epic: [
                'https://github.com/user-attachments/assets/62465d97-6e8d-422d-8a18-0b6237ba55b5',
                'https://github.com/user-attachments/assets/43606517-5f59-44c2-b294-4e2640fd09d4',
                'https://github.com/user-attachments/assets/5e37adb3-6c6f-4909-8a7f-f8bee8f00d20',
                'https://github.com/user-attachments/assets/205e01a4-a503-4820-811e-ca645df04cc7',
                'https://github.com/user-attachments/assets/fd99312f-e82d-4093-a365-9576908c844b',
                'https://github.com/user-attachments/assets/a375b0ee-b8d1-41b4-85ae-0121b300a582',
                'https://github.com/user-attachments/assets/260832e9-7020-4aa9-9bbb-790c08ef5c5a',
                'https://github.com/user-attachments/assets/09dc868f-3a5e-4091-8c56-a17d10ed8341',
                'https://github.com/user-attachments/assets/8537e5d5-0963-4715-9fe5-d2ea2ca2f1f4',
                'https://github.com/user-attachments/assets/4ce7d8a7-e4e1-4687-8e90-0593c1fd65e9'
            ],
            legendary: [
                'https://github.com/user-attachments/assets/16bda44b-7472-4f5b-8309-a173260c28f6',
                'https://github.com/user-attachments/assets/faea30d2-0311-4d6b-b85b-bfb031fa9f12',
                'https://github.com/user-attachments/assets/62a4d170-d580-4715-9a30-557355e458a8',
                'https://github.com/user-attachments/assets/22346c4c-a649-467d-93eb-2b00cc48f4de',
                'https://github.com/user-attachments/assets/cbc17b50-06ce-4d15-beb5-3547f7a56855',
                'https://github.com/user-attachments/assets/088764b9-b4a0-4538-b478-b549c70ab738',
                'https://github.com/user-attachments/assets/2a37d1dc-d2b2-45cb-b7df-5df8020e51bf',
                'https://github.com/user-attachments/assets/65e1e09b-4717-4911-b3fc-3543ef9b652b',
                'https://github.com/user-attachments/assets/f237ebbc-229d-46ad-9e41-79193720e509',
                'https://github.com/user-attachments/assets/0be46629-b37f-47d3-95d5-3a23041407a7'
            ],
            mythical: [
                'https://github.com/user-attachments/assets/950ce981-3ae2-4689-9640-c77ecf166e7c',
                'https://github.com/user-attachments/assets/6d64edfa-8cc3-44a6-80ea-e7e856189d3c',
                'https://github.com/user-attachments/assets/b49b0905-8972-44ac-a690-de7c62e82bba',
                'https://github.com/user-attachments/assets/a60df2c9-6612-4243-91e2-e55d932a2ba0',
                'https://github.com/user-attachments/assets/1da7e761-ac9f-4989-afe5-4b7bfac65f93',
                'https://github.com/user-attachments/assets/58c52ca3-952e-4c53-98a9-dcf5f7e9054a',
                'https://github.com/user-attachments/assets/079a6926-a776-44a5-b6c7-cbe0f406a776',
                'https://github.com/user-attachments/assets/7f970eb3-43de-4780-8ba9-ae9d35d79cf8',
                'https://github.com/user-attachments/assets/c6133dd5-2500-4713-b3fe-a2f01de63b79',
                'https://github.com/user-attachments/assets/97d86029-88be-4883-a4c1-73fa7dfd8ba7'
            ]
        };

        let inventory = JSON.parse(localStorage.getItem('inventory')) || [];
        let money = parseInt(localStorage.getItem('money')) || 0;
        let imageSize = parseInt(localStorage.getItem('imageSize')) || 15; // Default size
        let imageDuration = parseInt(localStorage.getItem('imageDuration')) || 1000; // Default duration (1 second)
        let inventoryLimit = parseInt(localStorage.getItem('inventoryLimit')) || 5; // Default inventory limit
        let luck = parseInt(localStorage.getItem('luck')) || 0; // Default luck

        let upgradeCosts = JSON.parse(localStorage.getItem('upgradeCosts')) || {
            imageSize: 10,
            imageDuration: 10,
            inventorySpace: 10,
            luck: 10
        };

        // Add stats and achievements tracking
        let stats = JSON.parse(localStorage.getItem('stats')) || {
            totalClicks: 0,
            totalItems: 0,
            rareFound: 0,
            mythicalFound: 0,
            legendaryFound: 0,
            epicFound: 0
        };

        // Make sure achievements are defined with proper structure
        const achievements = {
            collector_i: {
                name: "Collector I",
                description: "Collect 10 items",
                check: () => stats.totalItems >= 10,
                unlocked: false
            },
            collector_ii: {
                name: "Collector II",
                description: "Collect 100 items",
                check: () => stats.totalItems >= 100,
                unlocked: false
            },
            collector_iii: {
                name: "Collector III",
                description: "Collect 1,000 items",
                check: () => stats.totalItems >= 1000,
                unlocked: false
            },
            rare_i: {
                name: "Rare Hunter I",
                description: "Find 5 rare or better items",
                check: () => stats.rareFound >= 5,
                unlocked: false
            },
            rare_ii: {
                name: "Rare Hunter II",
                description: "Find 25 rare or better items",
                check: () => stats.rareFound >= 25,
                unlocked: false
            },
            mythical_i: {
                name: "Mythical I",
                description: "Find your first mythical item",
                check: () => stats.mythicalFound >= 1,
                unlocked: false
            },
            mythical_ii: {
                name: "Mythical II",
                description: "Find 5 mythical items",
                check: () => stats.mythicalFound >= 5,
                unlocked: false
            },
            money_i: {
                name: "Money I",
                description: "Have 10,000 money at once",
                check: () => money >= 10000,
                unlocked: false
            },
            money_ii: {
                name: "Money II",
                description: "Have 1,000,000 money at once",
                check: () => money >= 1000000,
                unlocked: false
            },
            clicks_i: {
                name: "Clicks I",
                description: "Click 1,000 times",
                check: () => stats.totalClicks >= 1000,
                unlocked: false
            },
            legendary_i: {
                name: "Legendary I",
                description: "Find 10 legendary items",
                check: () => stats.legendaryFound >= 10,
                unlocked: false
            },
            epic_i: {
                name: "Epic I",
                description: "Find 50 epic items",
                check: () => stats.epicFound >= 50,
                unlocked: false
            }
        };

function getRandomrarities() {
    const totalWeight = Object.values(rarities).reduce((sum, weight) => sum + weight, 0);
    let randomWeight = Math.random() * totalWeight;

    for (const rarity in rarities) {
        if (randomWeight < rarities[rarity]) {
            return rarity;
        }
        randomWeight -= rarities[rarity];
    }
}

        function getRandomImage() {
            const rarities = getRandomrarities();
            const image = images[rarities][Math.floor(Math.random() * images[rarities].length)];
            return { rarities, image };
        }

function displayImage() {
    const baseComparisons = 1; // Base number of comparisons
    const totalComparisons = baseComparisons + luck; // Increase comparisons based on luck

    let highestRarityImage = null; // Store the highest rarity image
    let highestRarityKey = 'common'; // Start with the lowest rarity

    // Define the order of rarities from lowest to highest
    const rarityOrder = ['common', 'uncommon', 'rare', 'epic', 'legendary', 'mythical'];

    // Generate and compare multiple random images
    for (let i = 0; i < totalComparisons; i++) {
        const randomImage = getRandomImage(); // Get a random image
        const currentRarityKey = randomImage.rarities;

        // Compare the current rarity with the highest rarity found so far
        if (rarityOrder.indexOf(currentRarityKey) > rarityOrder.indexOf(highestRarityKey)) {
            highestRarityKey = currentRarityKey;
            highestRarityImage = randomImage;
        }
    }

    // If no image was selected (shouldn't happen), default to a common image
    if (!highestRarityImage) {
        highestRarityImage = {
            image: images.common[Math.floor(Math.random() * images.common.length)],
            rarities: 'common'
        };
    }

    // Create an image element
    const imgElement = document.createElement('img');
    imgElement.src = highestRarityImage.image;
    imgElement.className = 'image';
    imgElement.alt = highestRarityImage.rarities;

    // Add click/touch handler with effects
    const handleInteraction = function(e) {
        e.preventDefault();
        if (inventory.length < inventoryLimit) {
            stats.totalClicks++;
            stats.totalItems++;
            
            // Add pop animation class
            imgElement.classList.add('pop');
            
            // Get click position for effect
            const rect = imgElement.getBoundingClientRect();
            const centerX = rect.left + rect.width / 2;
            const centerY = rect.top + rect.height / 2;
            
            // Create collection effect
            createCollectEffect(centerX, centerY, highestRarityImage.rarities);
            
            // Create particles based on rarity
            const colors = {
                common: '#cccccc',
                uncommon: '#00ff00',
                rare: '#0000ff',
                epic: '#purple',
                legendary: '#ffd700',
                mythical: '#ff0000'
            };
            
            createParticles(centerX, centerY, colors[highestRarityImage.rarities]);
            
            // Track rarity finds and handle special effects
            switch(highestRarityImage.rarities) {
                case 'mythical':
                    stats.mythicalFound++;
                    shakeScreen();
                    break;
                case 'legendary':
                    stats.legendaryFound++;
                    break;
                case 'epic':
                    stats.epicFound++;
                    break;
            }
            
            addToInventory(highestRarityImage.image);
            imgElement.remove();
            
            updateStats();
            checkAchievements();
        } else {
            alert('Inventory is full!');
        }
    };

    // Add both mouse and touch event listeners
    imgElement.addEventListener('click', handleInteraction);
    imgElement.addEventListener('touchstart', handleInteraction, { passive: false });

    // Get current gameArea dimensions
    const gameArea = document.getElementById('gameArea');
    const gameAreaRect = gameArea.getBoundingClientRect();
    
    // Calculate maximum allowed positions
    const maxTop = gameAreaRect.height - imageSize;
    const maxLeft = gameAreaRect.width - imageSize;

    // Ensure positions are within bounds
    const randomTop = Math.max(0, Math.min(maxTop, Math.random() * maxTop));
    const randomLeft = Math.max(0, Math.min(maxLeft, Math.random() * maxLeft));

    // Set random positions within the allowed range
    imgElement.style.top = `${randomTop}px`;
    imgElement.style.left = `${randomLeft}px`;
    imgElement.style.width = `${imageSize}px`;
    imgElement.style.height = `${imageSize}px`;

    document.getElementById('gameArea').appendChild(imgElement);

    // Remove image after the specified duration
    setTimeout(() => {
        if (imgElement.parentElement) {
            imgElement.remove();
        }
    }, imageDuration);
}

        function addToInventory(image) {
            inventory.push(image);
            localStorage.setItem('inventory', JSON.stringify(inventory));
            updateInventory();
        }

        function updateInventory() {
            const inventoryArea = document.getElementById('inventory');
            inventoryArea.innerHTML = '';

            inventory.forEach((image, index) => {
                const itemDiv = document.createElement('div');
                itemDiv.className = 'inventory-item';

                const imgElement = document.createElement('img');
                imgElement.src = image;

                const sellButton = document.createElement('button');
                sellButton.className = 'sell-button';
                sellButton.innerText = 'Sell';
                sellButton.onclick = function() {
                    sellItem(index);
                };

                itemDiv.appendChild(imgElement);
                itemDiv.appendChild(sellButton);
                inventoryArea.appendChild(itemDiv);
            });

            for (let i = inventory.length; i < inventoryLimit; i++) {
                const emptySlot = document.createElement('div');
                emptySlot.className = 'inventory-item';

                const emptyImg = document.createElement('div');
                emptyImg.style.width = '80px';
                emptyImg.style.height = '80px';
                emptyImg.style.backgroundColor = '#808080';
                emptyImg.style.display = 'block';
                emptyImg.style.marginBottom = '17px';

                emptySlot.appendChild(emptyImg);
                inventoryArea.appendChild(emptySlot);
            }
        }

function calculateAchievementBonus() {
    let bonus = 0;
    for (const achievement of Object.values(achievements)) {
        if (achievement.unlocked) {
            bonus += 1;
        }
    }
    document.getElementById('achievementBonus').textContent = bonus;
    return bonus;
}

function sellItem(index) {
    const imgSrc = inventory[index];
    let raritiesValue = 0;

    for (const rarities in images) {
        if (images[rarities].includes(imgSrc)) {
            switch (rarities) {
                case 'common': raritiesValue = 10; break;
                case 'uncommon': raritiesValue = 50; break;
                case 'rare': raritiesValue = 100; break;
                case 'epic': raritiesValue = 500; break;
                case 'legendary': raritiesValue = 1000; break;
                case 'mythical': raritiesValue = 7777; break;
            }
            break;
        }
    }

    // Apply achievement bonus
    const bonus = calculateAchievementBonus();
    raritiesValue = Math.floor(raritiesValue * (1 + bonus / 100));

    money += raritiesValue;
    inventory.splice(index, 1);

    localStorage.setItem('inventory', JSON.stringify(inventory));
    localStorage.setItem('money', money);
    updateMoneyDisplay(money, true);
    updateInventory();
    checkAchievements(); // Check achievements after selling
    updateUpgradeButtons();
}

let upgradeMultiplier = 1; // Default to 1x

function setMultiplier(multiplier) {
    upgradeMultiplier = multiplier;
    updateMultiplierDisplay(multiplier);
    updateUpgradeButtons();
}

function updateMultiplierDisplay(multiplier) {
    const buttons = ['buy1x', 'buy10x', 'buy100x', 'buyMax'];
    buttons.forEach(buttonId => {
        const button = document.getElementById(buttonId);
        const isSelected = (buttonId === `buy${multiplier}x`) || (buttonId === 'buyMax' && multiplier === 'max');
        button.style.backgroundColor = isSelected ? '#029516' : '#4CAF50';
    });
}

function calculateMaxUpgrades(baseCost, currentMoney) {
    let maxUpgrades = 0;
    let cost = baseCost;

    while (currentMoney >= cost) {
        maxUpgrades++;
        currentMoney -= cost;
        cost = Math.round(cost * 1.1); // Increase cost by 10% for each upgrade
    }

    return maxUpgrades;
}

function upgradeImageSize() {
    const baseCost = upgradeCosts.imageSize;
    let totalCost = baseCost;
    let upgrades = 1;

    if (upgradeMultiplier === 'max') {
        upgrades = calculateMaxUpgrades(baseCost, money);
        totalCost = 0;
        let currentCost = baseCost;
        for (let i = 0; i < upgrades; i++) {
            totalCost += currentCost;
            currentCost = Math.round(currentCost * 1.1);
        }
    } else {
        upgrades = upgradeMultiplier;
        totalCost = baseCost * upgrades;
    }

    if (money >= totalCost) {
        money -= totalCost;
        imageSize += 5 * upgrades;
        upgradeCosts.imageSize = Math.round(baseCost * Math.pow(10, upgrades));
        localStorage.setItem('money', money);
        localStorage.setItem('imageSize', imageSize);
        localStorage.setItem('upgradeCosts', JSON.stringify(upgradeCosts));
        updateMoneyDisplay(money, false);
        document.getElementById('upgradeImageSize').innerText = `Drop Size ($${upgradeCosts.imageSize})`;
        document.getElementById('currentSize').innerText = `${imageSize}px`;
    } else {
        alert('Not enough money!');
    }
}

function upgradeImageDuration() {
    const baseCost = upgradeCosts.imageDuration;
    let totalCost = baseCost;
    let upgrades = 1;

    if (upgradeMultiplier === 'max') {
        upgrades = calculateMaxUpgrades(baseCost, money);
        totalCost = 0;
        let currentCost = baseCost;
        for (let i = 0; i < upgrades; i++) {
            totalCost += currentCost;
            currentCost = Math.round(currentCost * 1.1);
        }
    } else {
        upgrades = upgradeMultiplier;
        totalCost = baseCost * upgrades;
    }

    if (money >= totalCost) {
        money -= totalCost;
        imageDuration += 500 * upgrades;
        upgradeCosts.imageDuration = Math.round(baseCost * Math.pow(1.1, upgrades));
        localStorage.setItem('money', money);
        localStorage.setItem('imageDuration', imageDuration);
        localStorage.setItem('upgradeCosts', JSON.stringify(upgradeCosts));
        updateMoneyDisplay(money, false);
        document.getElementById('upgradeImageDuration').innerText = `Drop Duration ($${upgradeCosts.imageDuration})`;
        document.getElementById('currentDuration').innerText = `${(imageDuration/1000).toFixed(1)}s`;
    } else {
        alert('Not enough money!');
    }
}

function upgradeInventorySpace() {
    const baseCost = upgradeCosts.inventorySpace;
    let totalCost = baseCost;
    let upgrades = 1;

    if (upgradeMultiplier === 'max') {
        upgrades = calculateMaxUpgrades(baseCost, money);
        totalCost = 0;
        let currentCost = baseCost;
        for (let i = 0; i < upgrades; i++) {
            totalCost += currentCost;
            currentCost = Math.round(currentCost * 1.1);
        }
    } else {
        upgrades = upgradeMultiplier;
        totalCost = baseCost * upgrades;
    }

    if (money >= totalCost) {
        money -= totalCost;
        inventoryLimit += 1 * upgrades;
        upgradeCosts.inventorySpace = Math.round(baseCost * Math.pow(1.1, upgrades));
        localStorage.setItem('money', money);
        localStorage.setItem('inventoryLimit', inventoryLimit);
        localStorage.setItem('upgradeCosts', JSON.stringify(upgradeCosts));
        updateMoneyDisplay(money, false);
        document.getElementById('upgradeInventorySpace').innerText = `Space ($${upgradeCosts.inventorySpace})`;
        document.getElementById('currentSpace').innerText = inventoryLimit;
    } else {
        alert('Not enough money!');
    }
}

function sellAllItems() {
    if (inventory.length === 0) {
        alert('Inventory is empty!');
        return;
    }

    let totalEarnings = 0;

    // Calculate total earnings from all items
    inventory.forEach((imgSrc) => {
        let raritiesValue = 0;

        for (const rarities in images) {
            if (images[rarities].includes(imgSrc)) {
                switch (rarities) {
                    case 'common': raritiesValue = 10; break;
                    case 'uncommon': raritiesValue = 5; break;
                    case 'rare': raritiesValue = 25; break;
                    case 'epic': raritiesValue = 100; break;
                    case 'legendary': raritiesValue = 500; break;
                    case 'mythical': raritiesValue = 7777; break;
                }
                break;
            }
        }

        totalEarnings += raritiesValue;
    });

    // Add earnings to money
    money += totalEarnings;
    inventory = []; // Clear the inventory

    // Update localStorage and UI
    localStorage.setItem('inventory', JSON.stringify(inventory));
    localStorage.setItem('money', money);
    updateMoneyDisplay(money, true);
    updateInventory();
    updateUpgradeButtons();
}

// Add event listener for the "Sell All" button
document.getElementById('sellAllButton').onclick = sellAllItems;

function upgradeLuck() {
    const baseCost = upgradeCosts.luck;
    let totalCost = baseCost;
    let upgrades = 1;

    if (upgradeMultiplier === 'max') {
        upgrades = calculateMaxUpgrades(baseCost, money);
        totalCost = 0;
        let currentCost = baseCost;
        for (let i = 0; i < upgrades; i++) {
            totalCost += currentCost;
            currentCost = Math.round(currentCost * 1.1);
        }
    } else {
        upgrades = upgradeMultiplier;
        totalCost = baseCost * upgrades;
    }

    if (money >= totalCost) {
        money -= totalCost;
        luck += 10 * upgrades;
        upgradeCosts.luck = Math.round(baseCost * Math.pow(1.1, upgrades));
        localStorage.setItem('money', money);
        localStorage.setItem('luck', luck);
        localStorage.setItem('upgradeCosts', JSON.stringify(upgradeCosts));
        updateMoneyDisplay(money, false);
        document.getElementById('upgradeLuck').innerText = `Luck ($${upgradeCosts.luck})`;
        document.getElementById('currentLuck').innerText = luck;
    } else {
        alert('Not enough money!');
    }
}
    
function displayraritiesChances() {
    const raritiesList = document.getElementById('raritiesList');
    for (const rarity in rarities) {
        const chance = Math.round(rarities[rarity]); // Round the chance to the nearest whole number
        const li = document.createElement('li');
        raritiesList.appendChild(li);
    }
}

function addStyleToHead() {
    const style = document.createElement('style');
    style.textContent = `
        @keyframes moneyGain {
            0% { color: inherit; }
            50% { color: #00ff00; }
            100% { color: inherit; }
        }
        
        @keyframes moneyLoss {
            0% { color: inherit; }
            50% { color: #ff0000; }
            100% { color: inherit; }
        }
        
        .money-gain {
            animation: moneyGain 1s ease;
        }
        
        .money-loss {
            animation: moneyLoss 1s ease;
        }
    `;
    document.head.appendChild(style);
}

function updateMoneyDisplay(newMoney, isGain = true) {
    const moneyDisplay = document.getElementById('money');
    moneyDisplay.innerText = `$${Math.round(newMoney)}`;
    
    // Remove existing animation classes
    moneyDisplay.classList.remove('money-gain', 'money-loss');
    
    // Force a reflow to restart animation
    void moneyDisplay.offsetWidth;
    
    // Add appropriate animation class
    moneyDisplay.classList.add(isGain ? 'money-gain' : 'money-loss');
}

function createParticles(x, y, color) {
    for (let i = 0; i < 8; i++) {
        const particle = document.createElement('div');
        particle.className = 'particle';
        particle.style.backgroundColor = color;
        particle.style.left = x + 'px';
        particle.style.top = y + 'px';
        particle.style.setProperty('--tx', (Math.random() - 0.5) * 100 + 'px');
        particle.style.setProperty('--ty', (Math.random() - 0.5) * 100 + 'px');
        document.body.appendChild(particle);
        setTimeout(() => particle.remove(), 1000);
    }
}

function shakeScreen() {
    const gameArea = document.getElementById('gameArea');
    gameArea.classList.add('shake');
    setTimeout(() => gameArea.classList.remove('shake'), 200);
}

function updateStats() {
    document.getElementById('totalClicks').innerText = stats.totalClicks;
    document.getElementById('totalItems').innerText = stats.totalItems;
    localStorage.setItem('stats', JSON.stringify(stats));
}

function checkAchievements() {
    let newUnlock = false;
    for (const [id, achievement] of Object.entries(achievements)) {
        if (!achievement.unlocked && achievement.check()) {
            achievement.unlocked = true;
            newUnlock = true;
            showAchievementNotification(achievement.name);
            console.log(`Achievement unlocked: ${achievement.name}`);
        }
    }
    if (newUnlock) {
        updateAchievementsDisplay();
        localStorage.setItem('achievements', JSON.stringify(achievements));
    }
}

function showAchievementNotification(name) {
    const notification = document.createElement('div');
    notification.style.position = 'fixed';
    notification.style.top = '20px';
    notification.style.left = '50%';
    notification.style.transform = 'translateX(-50%)';
    notification.style.backgroundColor = '#1a472a';
    notification.style.color = 'white';
    notification.style.padding = '10px 20px';
    notification.style.borderRadius = '5px';
    notification.style.zIndex = '1000';
    notification.textContent = `Achievement Unlocked: ${name}!`;
    
    document.body.appendChild(notification);
    setTimeout(() => notification.remove(), 3000);
}

function updateAchievementsDisplay() {
    const achievementsList = document.getElementById('achievementsList');
    achievementsList.innerHTML = '';
    
    for (const achievement of Object.values(achievements)) {
        const div = document.createElement('div');
        div.className = `achievement ${achievement.unlocked ? 'unlocked' : ''}`;
        div.innerHTML = `
            <span>${achievement.name}: ${achievement.description}</span>
            <span class="achievement-bonus">+1%</span>
        `;
        achievementsList.appendChild(div);
    }
    
    calculateAchievementBonus();
}

function createCollectEffect(x, y, rarity) {
    // Create floating text
    const text = document.createElement('div');
    text.className = 'collect-particle';
    text.style.left = `${x}px`;
    text.style.top = `${y}px`;
    text.style.color = '#ffffff'; // Make all text white
    text.style.position = 'absolute';
    text.style.pointerEvents = 'none';
    text.style.zIndex = '1000';
    text.style.fontWeight = 'bold';
    
    text.textContent = '+1';
    document.body.appendChild(text);
    
    // Remove the element after animation
    setTimeout(() => text.remove(), 500);
}

function updateUpgradeButtons() {
    const upgrades = {
        'upgradeImageSize': upgradeCosts.imageSize,
        'upgradeImageDuration': upgradeCosts.imageDuration,
        'upgradeInventorySpace': upgradeCosts.inventorySpace,
        'upgradeLuck': upgradeCosts.luck
    };

    for (const [buttonId, baseCost] of Object.entries(upgrades)) {
        const button = document.getElementById(buttonId);
        const multiplier = upgradeMultiplier === 'max' ? 
            calculateMaxUpgrades(baseCost, money) : 
            upgradeMultiplier;
        
        let totalCost = 0;
        if (upgradeMultiplier === 'max') {
            let currentCost = baseCost;
            for (let i = 0; i < multiplier; i++) {
                totalCost += currentCost;
                currentCost = Math.round(currentCost * 1.1);
            }
        } else {
            totalCost = baseCost * multiplier;
        }

        const displayText = {
            'upgradeImageSize': 'Drop Size',
            'upgradeImageDuration': 'Drop Duration',
            'upgradeInventorySpace': 'Space',
            'upgradeLuck': 'Luck'
        };

        button.innerText = `${displayText[buttonId]} ($${Math.round(totalCost)})`;
        button.classList.toggle('unaffordable', money < totalCost);
    }
}

window.onload = function() {
    addStyleToHead();
    document.getElementById('money').innerText = `$${Math.round(money)}`;
    updateInventory();
    setInterval(displayImage, 50);

    // Add event listeners for the upgrade buttons
    document.getElementById('upgradeImageSize').onclick = upgradeImageSize;
    document.getElementById('upgradeImageDuration').onclick = upgradeImageDuration;
    document.getElementById('upgradeInventorySpace').onclick = upgradeInventorySpace;
    document.getElementById('upgradeLuck').onclick = upgradeLuck;

    // Add event listeners for the multiplier buttons and set initial state
    document.getElementById('buy1x').onclick = function() { setMultiplier(1); };
    document.getElementById('buy10x').onclick = function() { setMultiplier(10); };
    document.getElementById('buy100x').onclick = function() { setMultiplier(100); };
    document.getElementById('buyMax').onclick = function() { setMultiplier('max'); };
    updateMultiplierDisplay(1); // Set initial multiplier display

    // Add event listeners for the "Sell All" button
    document.getElementById('sellAllButton').onclick = sellAllItems;

    // Update button texts with current costs
    document.getElementById('upgradeImageSize').innerText = `Drop Size ($${Math.round(upgradeCosts.imageSize)})`;
    document.getElementById('upgradeImageDuration').innerText = `Drop Duration ($${Math.round(upgradeCosts.imageDuration)})`;
    document.getElementById('upgradeInventorySpace').innerText = `Space ($${Math.round(upgradeCosts.inventorySpace)})`;
    document.getElementById('upgradeLuck').innerText = `Luck ($${Math.round(upgradeCosts.luck)})`;

    // Initialize stats display
    document.getElementById('currentSize').innerText = `${imageSize}px`;
    document.getElementById('currentDuration').innerText = `${(imageDuration/1000).toFixed(1)}s`;
    document.getElementById('currentSpace').innerText = inventoryLimit;
    document.getElementById('currentLuck').innerText = luck;

    // Remove the global touch event prevention
    // Only prevent default touch behavior in the game area
    document.getElementById('gameArea').addEventListener('touchmove', function(e) {
        e.preventDefault();
    }, { passive: false });

    // Remove the double-tap zoom prevention
    // The game area touch handling is sufficient

    // Adjust game area size on orientation change
    window.addEventListener('orientationchange', function() {
        const gameArea = document.getElementById('gameArea');
        gameArea.style.height = `${window.innerHeight * 0.6}px`;
    });

    // Load achievements from localStorage
    const savedAchievements = localStorage.getItem('achievements');
    if (savedAchievements) {
        const loadedAchievements = JSON.parse(savedAchievements);
        for (const [key, value] of Object.entries(loadedAchievements)) {
            if (achievements[key]) {
                achievements[key].unlocked = value.unlocked;
            }
        }
    }
    
    updateStats();
    updateAchievementsDisplay();
    checkAchievements();

    const achievementsHeader = document.getElementById('achievementsHeader');
    const achievementsList = document.getElementById('achievementsList');
    const toggleArrow = document.getElementById('toggleArrow');
    
    achievementsHeader.addEventListener('click', () => {
        const isVisible = achievementsList.style.display === 'block';
        achievementsList.style.display = isVisible ? 'none' : 'block';
        toggleArrow.textContent = isVisible ? 'â–¼' : 'â–²';
    });

    // Add periodic updates for button states
    setInterval(updateUpgradeButtons, 100);
};
    </script>

</body>
</html>
    </script>

</body>
</html>
